<!DOCTYPE html>
<html>
<head>
    <title>Application 1</title>
</head>

<body>  
    <h1 style="border: solid; border-color: blue;  width:300px;">APPLICATION : 1</h1>
    <tt><p>This application is connect to the dispatcher.<br><br> User: <b>Pippo</b>; <br> Connects to room: <b>1</b>;</p></tt>
    <div style="border:solid; width:200px;">
        <p id="now">Now Capacity: -</p>
        <p id="max">Max Capacity: 120</p>
    </div>

        <br/>
        <h4>Actions</h4>
        <input style="background: green" id="publish-room-1-PLUS" type="submit" value="[+1]"/>
        <input style="background: red" id="publish-room-1-MINUS" type="submit" value="[-1]"/>
        

        <br/>
        <h5>Log Resp. Server</h5>
        <textarea id="resp" rows="5" cols="50"></textarea>
</body>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.6.min.js"></script>
<script>

const nRoom = 1; //from db
const nUser = "Pippo"; //from db

const pubnub = new PubNub({
    publishKey : 'pub-c-c875966e-dfa8-418f-8b75-26d75c09e4eb',
    subscribeKey : 'sub-c-9d2252f0-974d-11e9-8107-d6b10db480fa'
});

const button_P = document.getElementById('publish-room-'+nRoom+'-PLUS');
const button_M = document.getElementById('publish-room-'+nRoom+'-MINUS');

button_P.addEventListener('click', () => {
   
    pubnub.publish({
        channel : 'countify-channel-rooms',
        message: {
            updatenowcapacity: +1,
            user: nUser,
            room: nRoom
        }
    }, function(status, response) {
        // Handle error here
    })
});

button_M.addEventListener('click', () => {

pubnub.publish({
    channel : 'countify-channel-rooms',
    message: {
        updatenowcapacity: -1,
        user: nUser,
        room: nRoom
    }
}, function(status, response) {
    // Handle error here
})
});

pubnub.subscribe({
    channels: ['countify-channel-room-'+nRoom]
});
pubnub.addListener({
    message: function(event) {
        let a = document.getElementById('resp');
        a.value +=event.message.respserver+"\n";

        let nowtext = document.getElementById('now');
        nowtext.innerHTML = "Now Capacity: " + event.message.now;
    }
});
</script>
</html>